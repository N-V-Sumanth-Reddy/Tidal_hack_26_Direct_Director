# Requirements Document: Ad Production Multi-Agent System

## Introduction

This feature extends the existing LangGraph-based ad video generation pipeline to produce production-ready artifacts for advertisement shoots. The system takes the storyboard output from the creative chain (concept → screenplays → storyboard) and generates comprehensive production planning documents including shotlists, location plans, budgets, schedules, crew/gear suggestions, legal checklists, and risk registers. This system explicitly removes video generation and focuses on pre-production planning for physical shoots.

## Glossary

- **System**: The ad production planning multi-agent system
- **Creative_Chain**: The existing concept → screenplay → storyboard pipeline (preserved)
- **Scene_Plan**: Structured JSON document containing detailed scene breakdown with shots, locations, cast, props, and technical requirements
- **Storyboard_Frame**: Static image generated by Gemini 2.5 Flash representing a key moment in a scene
- **Shotlist**: Detailed list of individual shots with camera angles, movements, and technical specifications
- **Location_Plan**: Document containing location requirements, alternates, and permit/constraint checklists
- **Budget_Estimate**: Financial projection with line items, assumptions, and cost drivers
- **Schedule_Plan**: Shoot schedule with days, company moves, and setup time estimates
- **Crew_Gear_Package**: Minimum viable crew and equipment list with optional upgrades
- **Legal_Clearance_Report**: Checklist for releases, trademarks, music rights, and regulatory compliance
- **Risk_Register**: Safety and operational risk assessment with mitigation strategies
- **Production_Pack**: Consolidated markdown document linking all production artifacts
- **HITL_Gate**: Human-in-the-loop checkpoint requiring manual approval before proceeding
- **LangGraph**: Orchestration framework using StateGraph pattern
- **State**: TypedDict containing all pipeline data
- **Node**: Processing function in the LangGraph workflow
- **Gemini_2.5_Flash**: Google's image generation model for storyboard frames

## Requirements

### Requirement 1: Preserve Existing Creative Chain

**User Story:** As a system architect, I want the existing creative chain preserved exactly, so that concept and screenplay generation remain unchanged.

#### Acceptance Criteria

1. THE System SHALL preserve the ad_concept_creation_node functionality without modification
2. THE System SHALL preserve the parallel screenplay generation nodes (Rajamouli and Shankar styles) without modification
3. THE System SHALL preserve the screenplay_evaluation_node for human selection without modification
4. THE System SHALL preserve the story_board_creation_node functionality without modification
5. THE System SHALL use Gemini 2.5 Flash for storyboard frame generation (not DALLE-3)

### Requirement 2: Remove Video Generation Pipeline

**User Story:** As a system architect, I want video generation removed from this pipeline, so that the system focuses on pre-production planning only.

#### Acceptance Criteria

1. THE System SHALL NOT include video_generation_node
2. THE System SHALL NOT include video_assembly_node
3. THE System SHALL NOT include any Veo 3.1 video generation functionality
4. THE System SHALL NOT include FFmpeg video assembly functionality
5. THE System SHALL terminate the pipeline after production planning artifacts are generated

### Requirement 3: Scene Plan Generation with Strict Schema

**User Story:** As a production planner, I want a detailed scene plan with strict JSON schema, so that downstream planning nodes have reliable structured data.

#### Acceptance Criteria

1. THE System SHALL add a scene_breakdown_node after storyboard frame generation
2. THE Scene_Plan SHALL include a scenes array with the following fields for each scene: scene_id (str), duration_sec (float), location_type (str: "INT" or "EXT"), time_of_day (str: "DAY" or "NIGHT"), location_description (str), cast_count (int), props (List[str]), wardrobe (List[str]), sfx_vfx (List[str]), dialogue_vo (str), on_screen_text (str)
3. THE Scene_Plan SHALL include a shots array with the following fields for each shot: shot_id (str), scene_id (str), shot_type (str: "WIDE", "MEDIUM", "CLOSE-UP", "INSERT", "POV"), camera_movement (str: "STATIC", "PAN", "TILT", "DOLLY", "STEADICAM"), duration_sec (float), description (str)
4. THE System SHALL validate that the sum of all shot durations within a scene equals the scene duration (±1 second tolerance)
5. THE System SHALL add a scene_plan field to the State TypedDict

### Requirement 4: Human-in-the-Loop Gate for Scene Plan Approval

**User Story:** As a production planner, I want to approve the scene plan before cost/schedule estimation, so that I can ensure accuracy before committing resources.

#### Acceptance Criteria

1. THE System SHALL add a scene_plan_approval_gate after scene_breakdown_node
2. WHEN the scene plan is generated, THE System SHALL display the scene_plan.json for human review
3. WHEN the user approves the scene plan, THE System SHALL proceed to parallel production planning nodes
4. WHEN the user rejects the scene plan, THE System SHALL allow regeneration with modified parameters
5. THE System SHALL not proceed to production planning nodes until scene plan is approved

### Requirement 5: Parallel Production Planning Nodes

**User Story:** As a production planner, I want production artifacts generated in parallel, so that planning is efficient and fast.

#### Acceptance Criteria

1. THE System SHALL execute the following nodes in parallel after scene plan approval: location_planning_node, budgeting_node, schedule_ad_node, casting_node, props_wardrobe_node, legal_clearance_node, risk_safety_node
2. WHEN all parallel nodes complete, THE System SHALL proceed to the client_review_pack_node
3. THE System SHALL handle errors in individual parallel nodes without blocking other nodes
4. THE System SHALL collect results from all parallel nodes before proceeding
5. THE System SHALL add the following fields to State: locations_plan, budget_estimate, schedule_plan, casting_suggestions, props_wardrobe_list, legal_clearance_report, risk_register

### Requirement 6: Location Planning Node

**User Story:** As a location scout, I want detailed location requirements and alternates, so that I can efficiently find suitable shooting locations.

#### Acceptance Criteria

1. THE Location_Planning_Node SHALL generate location requirements for each unique location in the scene plan
2. THE Locations_Plan SHALL include primary location requirements with: location_type (INT/EXT), description, key_features (List[str]), accessibility_requirements (str), power_requirements (str), space_requirements (str)
3. THE Locations_Plan SHALL include alternate location suggestions for each primary location
4. THE Locations_Plan SHALL include a permit and constraints checklist with: permits_required (List[str]), noise_restrictions (bool), time_restrictions (str), parking_availability (str), insurance_requirements (str)
5. THE System SHALL export the locations plan as both markdown and JSON

### Requirement 7: Budget Estimation Node

**User Story:** As a producer, I want a detailed budget estimate with assumptions, so that I can secure funding and manage costs.

#### Acceptance Criteria

1. THE Budgeting_Node SHALL generate a budget estimate with a total range (min and max)
2. THE Budget_Estimate SHALL include line items for: crew (by role), equipment rental, location fees, talent/casting, props and wardrobe, post-production, insurance, contingency (10-15%)
3. THE Budget_Estimate SHALL include explicit assumptions for each line item
4. THE Budget_Estimate SHALL identify cost drivers (factors that significantly impact budget)
5. THE System SHALL export the budget estimate as both markdown and CSV

### Requirement 8: Schedule Planning Node

**User Story:** As a production manager, I want a detailed shoot schedule, so that I can coordinate crew, talent, and locations efficiently.

#### Acceptance Criteria

1. THE Schedule_Ad_Node SHALL generate a shoot schedule with estimated shoot days
2. THE Schedule_Plan SHALL group scenes by location to minimize company moves
3. THE Schedule_Plan SHALL include setup time estimates for each scene
4. THE Schedule_Plan SHALL include company move time between locations
5. THE System SHALL export the schedule plan as both markdown and CSV

### Requirement 9: Crew and Gear Suggestion Node

**User Story:** As a production manager, I want crew and gear recommendations, so that I can assemble the right team and equipment.

#### Acceptance Criteria

1. THE System SHALL add a crew_gear_node that generates crew and equipment suggestions
2. THE Crew_Gear_Package SHALL include a minimum viable crew list with roles and responsibilities
3. THE Crew_Gear_Package SHALL include a minimum viable equipment list
4. THE Crew_Gear_Package SHALL include optional upgrades for crew and equipment
5. THE System SHALL base recommendations on scene complexity, location types, and technical requirements from the scene plan

### Requirement 10: Legal and Clearances Checklist Node

**User Story:** As a legal affairs coordinator, I want a comprehensive legal checklist, so that I can ensure compliance and avoid legal issues.

#### Acceptance Criteria

1. THE Legal_Clearance_Node SHALL generate a legal and clearances checklist
2. THE Legal_Clearance_Report SHALL include: talent releases required (List[str]), location releases required (List[str]), trademarks and logos to clear (List[str]), music rights required (List[str]), claims and substantiation requirements (List[str]), minor consent forms required (bool), drone permits required (bool)
3. THE System SHALL identify legal requirements based on scene plan content
4. THE System SHALL flag high-risk items requiring legal review
5. THE System SHALL export the legal clearance report as markdown

### Requirement 11: Risk and Safety Register Node

**User Story:** As a safety coordinator, I want a risk register with mitigation strategies, so that I can ensure crew and talent safety.

#### Acceptance Criteria

1. THE Risk_Safety_Node SHALL generate a risk register with identified risks
2. THE Risk_Register SHALL include risk categories: safety hazards, weather risks, night shoot risks, stunt risks, crowd management risks, equipment risks
3. THE Risk_Register SHALL include for each risk: risk_description (str), likelihood (str: "LOW", "MEDIUM", "HIGH"), impact (str: "LOW", "MEDIUM", "HIGH"), mitigation_strategy (str)
4. THE System SHALL identify risks based on scene plan content (location types, time of day, special effects, etc.)
5. THE System SHALL export the risk register as markdown

### Requirement 12: Human-in-the-Loop Gate for Budget and Schedule Approval

**User Story:** As a producer, I want to approve budget and schedule before final review pack, so that I can ensure financial and timeline feasibility.

#### Acceptance Criteria

1. THE System SHALL add a budget_schedule_approval_gate after parallel production planning nodes complete
2. WHEN budget and schedule are generated, THE System SHALL display them for human review
3. WHEN the user approves budget and schedule, THE System SHALL proceed to client_review_pack_node
4. WHEN the user rejects budget or schedule, THE System SHALL allow regeneration with modified constraints
5. THE System SHALL not proceed to client review pack until budget and schedule are approved

### Requirement 13: Client Review Pack Generation

**User Story:** As a producer, I want a consolidated review pack, so that I can present all production artifacts to the client in one document.

#### Acceptance Criteria

1. THE Client_Review_Pack_Node SHALL generate a single markdown document linking all production artifacts
2. THE Production_Pack SHALL include: executive summary, storyboard frames (with links), scene plan summary, shotlist, locations plan, budget estimate, schedule plan, crew and gear recommendations, legal clearances checklist, risk register
3. THE Production_Pack SHALL include a table of contents with links to each section
4. THE Production_Pack SHALL include metadata: brand name, theme, generation timestamp, total estimated budget, total shoot days
5. THE System SHALL export the production pack as markdown and PDF

### Requirement 14: State Management for Production Planning

**User Story:** As a system architect, I want the State TypedDict extended for production planning, so that all data flows correctly through the graph.

#### Acceptance Criteria

1. THE System SHALL extend the State TypedDict to include: scene_plan (dict), locations_plan (dict), budget_estimate (dict), schedule_plan (dict), casting_suggestions (dict), props_wardrobe_list (dict), legal_clearance_report (dict), risk_register (dict), production_pack (str)
2. THE System SHALL preserve existing State fields: theme, concept, screenplay_1, screenplay_2, screenplay_winner, story_board, storyboard_frames, overall_status
3. THE System SHALL use Annotated types with operator.add for fields that accumulate status messages
4. THE System SHALL maintain type safety throughout the pipeline
5. THE System SHALL validate State structure at each node transition

### Requirement 15: Regeneration with Changed Constraints

**User Story:** As a producer, I want to regenerate production artifacts with changed constraints, so that I can explore different budget/schedule scenarios without redoing the storyboard.

#### Acceptance Criteria

1. WHEN regenerating with changed constraints, THE System SHALL preserve the existing storyboard frames
2. WHEN regenerating with changed constraints, THE System SHALL preserve the existing scene plan (unless explicitly modified)
3. WHEN budget constraints are changed, THE System SHALL regenerate budget_estimate and schedule_plan
4. WHEN schedule constraints are changed, THE System SHALL regenerate schedule_plan and potentially budget_estimate
5. THE System SHALL allow constraint modification at HITL gates without restarting the entire pipeline

### Requirement 16: Minimum Viable Production Artifacts (MVP)

**User Story:** As a system operator, I want to verify MVP functionality, so that I can ensure the system produces all required artifacts.

#### Acceptance Criteria

1. WHEN given a theme, THE System SHALL output: winning screenplay, storyboard frames, scene_plan.json, locations_plan, budget_estimate, schedule_plan, legal_clearance_report, risk_register, production_pack
2. THE Scene_Plan SHALL pass JSON schema validation
3. THE Budget_Estimate SHALL include explicit assumptions
4. THE Schedule_Plan SHALL include explicit assumptions
5. THE System SHALL complete the full pipeline from theme to production pack

### Requirement 17: Error Handling and Partial Results

**User Story:** As a system operator, I want robust error handling, so that failures in one planning node don't block the entire pipeline.

#### Acceptance Criteria

1. WHEN a parallel planning node fails, THE System SHALL continue executing other parallel nodes
2. WHEN a parallel planning node fails, THE System SHALL log the error and mark that artifact as unavailable
3. WHEN the client review pack is generated, THE System SHALL include all available artifacts and note any missing artifacts
4. THE System SHALL update overall_status with error details for failed nodes
5. THE System SHALL allow manual retry of failed nodes without restarting the entire pipeline

### Requirement 18: Export Formats for Production Artifacts

**User Story:** As a production coordinator, I want artifacts in multiple formats, so that I can use them in different tools and workflows.

#### Acceptance Criteria

1. THE System SHALL export shotlist as both markdown and CSV
2. THE System SHALL export locations plan as both markdown and JSON
3. THE System SHALL export budget estimate as both markdown and CSV
4. THE System SHALL export schedule plan as both markdown and CSV
5. THE System SHALL export the final production pack as both markdown and PDF
